jQuery(function(a){initArea("area.cuaca-control"),initMenu(".menu-cuaca-item a"),renderCuaca("area.cuaca-control",dataCuaca),applyAttributes($("#jenis_pekerjaan_id")),$(document).on("change","select.resource-bill-of-quantity",function(a){let t=$(this);setMinMaxVolume(t)}),$(document).on("change","#jenis_pekerjaan_id",function(a){let t=$(this).val();applyAttributes($("#jenis_pekerjaan_id")),$.ajax({url:"lib.mobile-tools/ajax-load-peralatan-pekerjaan.php",type:"GET",dataType:"json",data:{id:t},success:function(a){let t,e=$("select.resource-peralatan");for(t in e.empty().append('<option value=""></option>'),a)e.append('<option value="'+a[t].v+'">'+a[t].l+"</option>")}}),$.ajax({url:"lib.mobile-tools/ajax-load-material-pekerjaan.php",type:"GET",dataType:"json",data:{id:t},success:function(a){let t,e=$("select.resource-material");for(t in e.empty().append('<option value=""></option>'),a)e.append('<option value="'+a[t].v+'">'+a[t].l+"</option>")}})}),$(document).on("change","#bill_of_quantity_id",function(a){let t=$(this).val(),e=$(this).find("option:selected").attr("data-proyek-id");$.ajax({url:"lib.mobile-tools/ajax-load-bill-of-quantity.php",type:"GET",dataType:"html",data:{proyek_id:e,parent_id:t},success:function(a){let t=$(".resource-bill-of-quantity");t.empty(),t.append(a)}})}),$(document).on("error","#static-map-image",function(a){$(this).replaceWith('<div data-role="error">Tidak bisa menampilkan peta.</div>')}),$(document).on("change","#lokasi_proyek_id",function(a){detectLocation()}),$(document).on("click",".remover",function(a){let t=$(this).closest("tr");confirm("Apakah Anda akan menghapus item ini?")&&t.remove()}),$(document).on("click","#tambah-peralatan",function(a){let t=$(".resource-peralatan")[0].outerHTML,e=$("<tr>\r\n<td>"+t+'</td>\r\n<td>\r\n<input type="number" step="any" min="0" value="1" class="form-control" required="required">\r\n</td>\r\n<td>\r\n<button type="button" class="btn btn-danger remove-peralatan">&#215;</button>\r\n</td>\r\n</tr>\r\n');e.find(".resource-peralatan").attr({required:"required"}),$("#tabel-peralatan tbody").append(e),fixPeralatan()}),$(document).on("click",".remove-peralatan",function(a){$(this).closest("tr").remove(),fixPeralatan()}),$(document).on("click","#tambah-material",function(a){let t=$(".resource-material")[0].outerHTML,e=$("<tr>\r\n<td>"+t+'</td>\r\n<td>\r\n<input type="number" step="any" min="0" value="1" class="form-control" required="required">\r\n</td>\r\n<td>\r\n<button type="button" class="btn btn-danger remove-material">&#215;</button>\r\n</td>\r\n</tr>\r\n');e.find(".resource-material").attr({required:"required"}),$("#tabel-material tbody").append(e),fixMaterial()}),$(document).on("click",".remove-material",function(a){$(this).closest("tr").remove(),fixMaterial()}),$(document).on("click","#tambah-boq",function(a){let t=$(".resource-bill-of-quantity")[0].outerHTML,e=$("<tr>\r\n<td>"+t+'</td>\r\n<td>\r\n<input type="number" step="any" min="0" value="" class="form-control volume" required="required">\r\n</td>\r\n<td>\r\n<button type="button" class="btn btn-danger remove-boq">&#215;</button>\r\n</td>\r\n</tr>\r\n');e.find(".resource-bill-of-quantity").attr({required:"required"}),$("#tabel-boq tbody").append(e),setMinMaxVolume(e.find("select")),fixBoq()}),$(document).on("click",".remove-boq",function(a){$(this).closest("tr").remove(),fixBoq()}),$(document).on("click","#tambah-man-power",function(a){let t=$(".resource-man-power")[0].outerHTML,e=$("<tr>\r\n<td>"+t+'</td>\r\n<td>\r\n<input type="number" step="any" min="1" value="1" class="form-control" required="required">\r\n</td>\r\n<td>\r\n<button type="button" class="btn btn-danger remove-man-power">&#215;</button>\r\n</td>\r\n</tr>\r\n');e.find(".resource-man-power").attr({required:"required"}),$("#tabel-man-power tbody").append(e),fixManPower()}),$(document).on("click",".remove-man-power",function(a){$(this).closest("tr").remove(),fixManPower()}),$(document).on("change",".resource-man-power",function(a){let t=$(this),e=t.closest("tr").find('[type="number"]'),n=t.find("option:selected").attr("data-jumlah-pekerja");null!=n?e.val(n):e.val(""),setTotal()}),$(document).on("change",'#tabel-man-power tbody [type="number"]',function(a){setTotal()}),$(document).on("click",".remove-issue",function(a){let t=$(this).closest("table");$(this).closest("tbody").find("tr").length>1&&$(this).closest("tr").remove(),fixRekomendasiPermasalahan(t)}),$(document).on("click",".add-issue",function(a){let t=$(this).closest("table"),e=$(this).closest("table").find("tbody tr:last-child").clone();$(this).closest("table").find("tbody tr:last-child").after(e),fixRekomendasiPermasalahan(t)}),$(document).on("change",'.table-permasalahan [data-col-name="ditutup"] input[type="checkbox"]',function(){$(this).prop("checked")?closeIssue($(this).closest("tr").attr("data-primary-key")):openIssue($(this).closest("tr").attr("data-primary-key"))}),$(document).on("change",'.table-rekomendasi [data-col-name="ditutup"] input[type="checkbox"]',function(){$(this).prop("checked")?closeRecomendation($(this).closest("tr").attr("data-primary-key")):openRecomendation($(this).closest("tr").attr("data-primary-key"))}),$("#permasalahan-modal").on("shown.bs.modal",function(){let a=$("#permasalahan-modal");a.attr("data-mode","list"),a.find(".add-issue, .save-issue, .cancel-issue").prop("disabled",!0);let t=$(this).attr("data-proyek-id");$.ajax({url:"lib.mobile-tools/ajax-load-permasalahan.php",method:"GET",data:{proyek_id:t},success:function(t){a.find(".modal-body").html(t),a.find(".add-issue, .save-issue, .cancel-issue").prop("disabled",!1)},error:function(){a.find(".modal-body").html('<div class="alert alert-warning">Terjadi kesalahan dalam memuat data.</div>')}})}),$("#permasalahan-modal").on("hidden.bs.modal",function(a){emptyOption($('[data-name="permasalahan_id"]'));$("#permasalahan-modal").find("table tbody tr").each(function(a){let t=$(this).attr("data-value")||"",e=$(this).attr("data-permasalahan-id"),n=$(this).attr("data-permasalahan")+" : "+$(this).attr("data-rekomendasi")+" : "+$(this).attr("data-tindak-lanjut"),o=$("<option>",{value:e,text:n,selected:t==e});$('[data-name="permasalahan_id"]').append(o)})}),$(document).on("click",".add-issue",function(a){let t=$(this).closest(".modal");t.attr("data-mode","edit"),t.find('[name="permasalahan_id"]').val("")}),$(document).on("click",".edit-issue",function(a){let t=$(this).closest(".modal");t.attr("data-mode","edit"),t.find('[name="permasalahan_id"]').val($(this).closest("tr").attr("data-permasalahan-id")),t.find('[name="permasalahan"]').val($(this).closest("tr").attr("data-permasalahan")),t.find('[name="rekomendasi"]').val($(this).closest("tr").attr("data-rekomendasi")),t.find('[name="tindak_lanjut"]').val($(this).closest("tr").attr("data-tindak-lanjut"))}),$(document).on("click",".save-issue",function(a){let t=$(this).closest(".modal");t.find(".add-issue, .save-issue, .cancel-issue").prop("disabled",!0);let e=t.attr("data-proyek-id"),n=t.find('[name="permasalahan_id"]').val(),o=t.find('[name="permasalahan"]').val(),i=t.find('[name="rekomendasi"]').val(),r=t.find('[name="tindak_lanjut"]').val();$.ajax({url:"lib.mobile-tools/ajax-load-permasalahan.php?proyek_id="+e,method:"POST",data:{proyek_id:e,permasalahan:o,rekomendasi:i,tindak_lanjut:r,permasalahan_id:n},success:function(a){for(t.find(".modal-body").html(a),t.find(".add-issue, .save-issue, .cancel-issue").prop("disabled",!1),t.attr("data-mode","list");$("#permasalahan_id option").length>1;)$("#permasalahan_id option:last").remove();emptyOption($('[data-name="permasalahan_id"]')),t.find("table tbody tr").each(function(a){let t=$(this).attr("data-value")||"",e=$(this).attr("data-permasalahan-id"),n=$(this).attr("data-permasalahan")+" : "+$(this).attr("data-rekomendasi")+" : "+$(this).attr("data-tindak-lanjut"),o=$("<option>",{value:e,text:n,selected:t==e});$('[data-name="permasalahan_id"]').append(o)})},error:function(){$(".modal-body").html('<div class="alert alert-warning">Terjadi kesalahan dalam memuat data.</div>')}})}),$(document).on("click",".cancel-issue",function(a){let t=$(this).closest(".modal");t.attr("data-mode","list"),t.find('[name="permasalahan_id"]').val("")}),$(".resource-peralatan").load("lib.mobile-tools/ajax-load-peralatan.php",function(){$("#tabel-peralatan tbody tr").each(function(){let a=$(this),t=a.attr("data-value")||"";""!=t&&a.find("select").val(t)})}),$(".resource-material").load("lib.mobile-tools/ajax-load-material.php",function(){$("#tabel-material tbody tr").each(function(){let a=$(this),t=a.attr("data-value")||"";""!=t&&a.find("select").val(t)})}),loadAcuanPengawasan(),document.querySelector("#tabel-boq").addEventListener("change",function(a){a.target.closest(".resource-bill-of-quantity")&&loadAcuanPengawasan()}),document.querySelector('[name="proyek_id"]').addEventListener("change",function(a){loadAcuanPengawasan()}),$(document).on("click",".add-man-power",function(a){let t=$(this).closest(".modal");t.find('[name="man_power_id"]').val(""),t.find('[name="proyek_id"]').val(t.attr("data-proyek-id")),t.find('[name="nama"]').val(""),t.find('[name="pekerjaan"]').val(""),t.find('[name="jumlah_pekerja"]').val(""),t.attr("data-mode","edit")}),$(document).on("click",".cancel-man-power",function(a){$(this).closest(".modal").attr("data-mode","list")}),$(document).on("click",".edit-man-power",function(a){let t=$(this).closest("tr"),e=t.attr("data-nama"),n=t.attr("data-pekerjaan"),o=t.attr("data-jumlah-pekerja"),i=t.attr("data-man-power-id"),r=t.attr("data-proyek-id"),l=$(this).closest(".modal");l.find('[name="proyek_id"]').val(r),l.find('[name="man_power_id"]').val(i),l.find('[name="nama"]').val(e),l.find('[name="pekerjaan"]').val(n),l.find('[name="jumlah_pekerja"]').val(o),l.attr("data-mode","edit")}),$(document).on("click",".save-man-power",function(a){let t=$(this).closest(".modal"),e=t.find("form.data-form-edit"),n=e.find('[name="proyek_id"]').val(),o=e.find('[name="man_power_id"]').val(),i=e.find('[name="nama"]').val(),r=e.find('[name="pekerjaan"]').val(),l=e.find('[name="jumlah_pekerja"]').val();$.ajax({url:"lib.mobile-tools/ajax-load-man-power.php",method:"POST",data:{action:"edit",manPowerId:o,proyekId:n,nama:i,pekerjaan:r,jumlahPekerja:l},success:function(a){listManPower(t)},error:function(){t.find(".data-form-list").html('<div class="alert alert-warning">Terjadi kesalahan dalam memuat data.</div>')}})}),$("#man-power-modal").on("shown.bs.modal",function(){let a=$(this).closest(".modal");listManPower(a)}),$("#man-power-modal").on("hidden.bs.modal",function(a){let t=$(this).closest(".modal").find(".data-form-list tbody"),e=t.attr("data-label-option-select-one"),n=[],o=$("#tabel-man-power .resource-man-power");if(o.length>0){o.each(function(){n.push($(this).val())}),o.empty();let i=$("<option />");i.attr("value",""),i.text(e),o.append(i),t.find("tr").each(function(a){let t=$(this),e=$("<option />");e.attr("value",t.attr("data-man-power-id")),e.attr("data-jumlah-pekerja",t.attr("data-jumlah-pekerja")),e.text(t.attr("data-nama-lengkap")),o.append(e)}),o.each(function(a){let t=parseInt(a);$(this).val(n[t])})}}),optionManPower()});let geolocationOptions={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};function optionManPower(){$.ajax({url:"lib.mobile-tools/ajax-load-man-power.php",type:"GET",dataType:"html",data:{proyek_id:$("#man-power-modal").attr("data-proyek-id")},success:function(a){let t=$(".resource-man-power");t.empty(),t.append(a),$("#tabel-man-power tbody tr").each(function(){let a=$(this).attr("data-value")||"";""!=a&&$(this).find("select").val(a)})}})}function listManPower(a){a.attr("data-mode","list");let t=a.attr("data-proyek-id");$.ajax({url:"lib.mobile-tools/ajax-load-man-power.php",method:"GET",data:{action:"list",proyek_id:t},success:function(t){a.find(".data-form-list").html(t)},error:function(){a.find(".data-form-list").html('<div class="alert alert-warning">Terjadi kesalahan dalam memuat data.</div>')}})}function emptyOption(a){for(;a.find("option").length>1;)a.find("option:last-child").remove()}function fixMaterial(){$("#tabel-material tbody").find("tr").each(function(a){let t=$(this);t.find("select").attr("name",`material_id[${a}]`),t.find('input[type="number"]').attr("name",`jumlah_material[${a}]`)})}function fixPeralatan(){$("#tabel-peralatan tbody").find("tr").each(function(a){let t=$(this);t.find("select").attr("name",`peralatan_id[${a}]`),t.find('input[type="number"]').attr("name",`jumlah_peralatan[${a}]`)})}function fixBoq(){$("#tabel-boq tbody").find("tr").each(function(a){let t=$(this);t.find("select").attr("name",`boq_id[${a}]`),t.find('input[type="number"]').attr("name",`jumlah_boq[${a}]`)})}function fixManPower(){$("#tabel-man-power tbody").find("tr").each(function(a){let t=$(this);t.find("select").attr("name",`man_power_id[${a}]`),t.find('input[type="number"]').attr("name",`jumlah_man_power[${a}]`)})}function setTotal(){let a=0;$("#tabel-man-power tbody").find("tr").each(function(t){let e=parseInt($(this).find('[type="number"]').val());isNaN(e)&&(e=0),a+=e}),$("#total-man-power").text(`Total ${a} orang`)}function setMinMaxVolume(a){let t=a.find("option:selected").attr("data-volume"),e=a.find("option:selected").attr("data-volume-proyek");""==t&&(t="0"),""==e&&(e="0");let n=parseFloat(t),o=parseFloat(e),i=a.closest("tr").find("input.volume");i.attr("min",o),i.attr("max",n)}function detectLocation(){navigator.geolocation.getCurrentPosition(onSuccess,onError,geolocationOptions)}function onSuccess(a){$('[name="latitude"]').val(a.coords.latitude),$('[name="longitude"]').val(a.coords.longitude),$('[name="altitude"]').val(a.coords.altitude)}function onError(a){let t="";switch(a.code){case a.PERMISSION_DENIED:t="Pengguna menolak permintaan geolokasi.";break;case a.POSITION_UNAVAILABLE:t="Geolokasi tidak tersedia.";break;case a.TIMEOUT:t="Tenggang waktu permintaan geolokasi telah habis.";break;case a.UNKNOWN_ERROR:t="Terjadi kesalahan yang tidak diketahui."}alert(t)}function applyAttributes(a){let t=a.find("option:selected").attr("data-tipe-pondasi-id"),e=a.find("option:selected").attr("data-kelas-tower-id"),n=a.find("option:selected").attr("data-lokasi-proyek-id"),o=a.find("option:selected").attr("data-kegiatan");"0"==t?($("#tipe_pondasi_id").val("").removeAttr("required"),$("#tipe_pondasi_id").closest("tr").css("display","none")):($("#tipe_pondasi_id").attr("required","required"),$("#tipe_pondasi_id").closest("tr").css("display","table-row")),"0"==e?($("#kelas_tower_id").val("").removeAttr("required"),$("#kelas_tower_id").closest("tr").css("display","none")):($("#kelas_tower_id").attr("required","required"),$("#kelas_tower_id").closest("tr").css("display","table-row")),"0"==n?($("#lokasi_proyek_id").val("").removeAttr("required"),$("#lokasi_proyek_id").closest("tr").css("display","none"),$("#tambah-lokasi").closest("tr").css("display","none")):($("#lokasi_proyek_id").attr("required","required"),$("#lokasi_proyek_id").closest("tr").css("display","table-row"),$("#tambah-lokasi").closest("tr").css("display","table-row")),"0"==o?($("#kegiatan").val("").removeAttr("required"),$("#kegiatan").closest("tr").css("display","none")):($("#kegiatan").attr("required","required"),$("#kegiatan").closest("tr").css("display","table-row"))}function tambahLokasi(){let a=$('form[name="formlokasi_proyek"] [name="nama"]').val().trim(),t=$('form[name="formlokasi_proyek"] [name="kode_lokasi"]').val().trim(),e=$('form[name="formlokasi_proyek"] [name="proyek_id"]').val().trim(),n=$('form[name="formlokasi_proyek"] [name="latitude"]').val().trim(),o=$('form[name="formlokasi_proyek"] [name="longitude"]').val().trim(),i=$('form[name="formlokasi_proyek"] [name="atitude"]').val().trim();return""!=a&&""!=e&&$.ajax({url:"lib.mobile-tools/ajax-add-lokasi-proyek.php",type:"POST",dataType:"json",data:{action:"add",nama:a,kode_lokasi:t,proyek_id:e,latitude:n,longitude:o,atitude:i},success:function(a){let t=$('[name="lokasi_proyek_id"]');t.empty();let e;for(e in a)t.append('<option value="'+a[e].v+'">'+a[e].l+"</option>");$("#addLocation").removeAttr("disabled"),$("#add-location-modal").modal("hide")}}),!1}function fixRekomendasiPermasalahan(a){a.find("tbody").find("tr").each(function(a){$(this).find('[data-name="permasalahan_id"]').attr("name",`permasalahan_id[${a}]`),$(this).find('[data-name="rekomendasi_id"]').attr("name",`rekomendasi_id[${a}]`)})}function closeIssue(a){issue(a,1)}function openIssue(a){issue(a,0)}function issue(a,t){$.ajax({method:"POST",url:"lib.mobile-tools/ajax-load-permasalahan.php",data:{user_action:"set-status",permasalahan_id:a,status:t},function(a){}})}function closeRecomendation(a){recomendation(a,1)}function openRecomendation(a){recomendation(a,0)}function recomendation(a,t){$.ajax({method:"POST",url:"lib.mobile-tools/ajax-load-rekomendasi.php",data:{user_action:"set-status",rekomendasi_id:a,status:t},function(a){}})}function loadAcuanPengawasan(){let a=document.querySelector('[name="proyek_id"]').value,t=[],e=document.querySelector("#tabel-boq").querySelectorAll(".resource-bill-of-quantity");e&&e.forEach((a,e)=>{""!=a.value&&t.push(a.value)}),$.ajax({method:"GET",url:"lib.mobile-tools/ajax-load-acuan-pengawasan-pekerjaan.php",data:{proyekId:a,billOfQuantityId:t},success:function(a){document.querySelector(".acuan-pengawasan-container").innerHTML=a}})}