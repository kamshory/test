var labels=[],data=[];Chart.defaults.pointHitDetectionRadius=1,Chart.defaults.plugins.tooltip.enabled=!1,Chart.defaults.plugins.tooltip.mode="index",Chart.defaults.plugins.tooltip.position="nearest",Chart.defaults.plugins.tooltip.external=coreui.ChartJS.customTooltips,Chart.defaults.defaultFontColor="rgba(75, 192, 192, 1)";let chartCanvas,ctx,minDate,maxDate,sChart,draggingPoint=null,editorLocked=!1,snapY=.25,chartConfig={},elemMinDate=null,elemMaxDate=null,clbkFunc=function(){};function initChart(t,e,a,n,l){clbkFunc=l,elemMinDate=e,elemMaxDate=a,ctx=(chartCanvas=document.querySelector(t,e,a)).getContext("2d");let i=document.querySelector(e).value,o=document.querySelector(a).value;""==i&&(i=convertTimestampToDate(new Date().getTime()),document.querySelector(e).value=i,setTimeout(function(){document.querySelector(e).value=i},10)),""==o&&(o=convertTimestampToDate(new Date().getTime()+25056e5),setTimeout(function(){document.querySelector(a).value=o},10)),minDate=new Date(i+"T00:00:00").getTime(),maxDate=new Date(o+"T23:59:59").getTime(),n&&(chartCanvas.addEventListener("click",function(t){if(!editorLocked){let e=chartCanvas.getBoundingClientRect(),a=t.clientX-e.left,n=t.clientY-e.top,l=sChart.scales.x.getValueForPixel(a),i=labels.length>0?labels[labels.length-1]:0;l=fixHour(l);let o=sChart.scales.y.getValueForPixel(n);l>i&&o<=chartConfig.options.scales.y.max&&(o=snapValue(o,snapY),labels.push(l),data.push(o),sChart.update(),clbkFunc(labels,data))}}),chartCanvas.addEventListener("contextmenu",function(t){t.preventDefault(),labels.length>0&&data.length>0&&(labels.pop(),data.pop(),sChart.update(),clbkFunc(labels,data))}),chartCanvas.addEventListener("mousedown",function(t){let e=sChart.getElementsAtEventForMode(t,"nearest",{intersect:!0},!1);e.length&&(draggingPoint=e[0])}),chartCanvas.addEventListener("mousemove",function(t){if(draggingPoint){editorLocked=!0;let e=sChart.scales.y,a=Chart.helpers.getRelativePosition(t,sChart),n=e.getValueForPixel(a.y);n=snapValue(n,snapY),sChart.data.datasets[draggingPoint.datasetIndex].data[draggingPoint.index]=Math.max(0,Math.min(100,n)),sChart.update(),clbkFunc(labels,data)}}),chartCanvas.addEventListener("mouseup",function(){draggingPoint=null,setTimeout(function(){editorLocked=!1},2)}),chartCanvas.addEventListener("mouseout",function(){draggingPoint=null}),$(document).on("blur",elemMinDate,function(){let t=$(this);setTimeout(function(){let e=t.val();minDate=new Date(e+"T00:00:00").getTime(),createChart()},10)}),$(document).on("blur",elemMaxDate,function(){let t=$(this);setTimeout(function(){let e=t.val();maxDate=new Date(e+"T23:59:59").getTime(),createChart()},10)}))}function createChart(){sChart&&sChart.destroy(),chartConfig={type:"line",data:{labels:labels,datasets:[{label:"Rencana",data:data,borderColor:"rgba(75, 192, 192, 1)",fill:!1,tension:.2}]},options:{animation:!1,scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"dd MMM yyyy"},title:{display:!0,text:"Tanggal"},min:minDate,max:maxDate},y:{beginAtZero:!0,min:0,max:105,title:{display:!0,text:"Rencana (%)"}}},plugins:{tooltip:{backgroundColor:"white",borderColor:"black",borderWidth:1,callbacks:{label:function(t){let e=t.dataset.label||"";return e&&(e+=": "),null!==t.parsed.y&&(e+=t.parsed.y.toFixed(2)+"%"),e}}}},maintainAspectRatio:!1}},sChart=new Chart(ctx,chartConfig)}function convertTimestampToDatetime(t){let e=new Date(t),a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");return`${a}-${n}-${l} ${i}:${o}:${r}`}function convertTimestampToDate(t){let e=new Date(t),a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${a}-${n}-${l}`}function fixHour(t){let e=new Date(t);e.setHours(0,0,0,0);let a=e.getTime();return t-a>432e5&&(a+=864e5),a}function snapValue(t,e){return t>100&&(t=100),t<0&&(t=0),Math.round(t/e)*e}function moveLeft(){for(let t in labels)labels[t]=labels[t]-864e5;sChart.update(),clbkFunc(labels,data)}function moveRight(){for(let t in labels)labels[t]=labels[t]+864e5;sChart.update(),clbkFunc(labels,data)}function moveUp(){let t=0;for(let e in data)data[e]>t&&(t=data[e]);if(t<=99){for(let a in data)data[a]=data[a]+1;sChart.update(),clbkFunc(labels,data)}}function moveDown(){let t=100;for(let e in data)data[e]<t&&(t=data[e]);if(t>=1){for(let a in data)data[a]=data[a]-1;sChart.update(),clbkFunc(labels,data)}}function save(){let t=JSON.stringify({labels:labels,data:data});console.log(t)}