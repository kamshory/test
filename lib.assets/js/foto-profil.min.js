let ratio=1,currentLatitude=null,currentLongitude=null,videoContainer=null,video=null,sourceCanvas=null,croppedCanvas=null,ctxSource=null,ctxCropped=null,videoWidth=320,videoHeight=320,width=320,height=320,shutter;function setDimension(e,t){croppedCanvas.width=e,croppedCanvas.style.width=e+"px",videoContainer.style.width=e+"px";let o=e/t;sourceCanvas.height=o;let i=videoHeight*t;sourceCanvas.width=i,sourceCanvas.style.width=i+"px",sourceCanvas.style.height=o+"px",croppedCanvas.style.height=o+"px",videoContainer.style.height=o+"px"}function detectGeolocation(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{let o=t.coords.latitude,i=t.coords.longitude;null!=e&&e(o,i)},e=>{console.error("Error getting location:",e)}):console.log("Geolocation is not supported by this browser.")}async function setupCamera(){let e=await navigator.mediaDevices.getUserMedia({video:!0});video.srcObject=e,video.onloadedmetadata=()=>{let e=height/video.videoHeight;videoWidth=video.videoWidth*e,videoHeight=video.videoHeight*e,video.width=videoWidth,video.height=videoHeight;let t=height*videoWidth/videoHeight;sourceCanvas.height=height,sourceCanvas.width=t,sourceCanvas.style.height=height+"px",sourceCanvas.style.width=t+"px",croppedCanvas.style.height=height+"px",videoContainer.style.height=height+"px",videoContainer.style.width=width+"px",document.getElementById("captureButton").disabled=!1}}document.addEventListener("DOMContentLoaded",function(){shutter=new Audio("lib.assets/sounds/camera.mp3"),videoContainer=document.getElementById("videoContainer"),video=document.getElementById("video"),sourceCanvas=document.getElementById("sourceCanvas"),croppedCanvas=document.getElementById("croppedCanvas"),ctxSource=sourceCanvas.getContext("2d"),ctxCropped=croppedCanvas.getContext("2d"),videoWidth=320,videoHeight=320,document.getElementById("captureButton").addEventListener("click",()=>{shutter.play(),ctxSource.drawImage(video,0,0,sourceCanvas.width,sourceCanvas.height);let e=sourceCanvas.width,t=sourceCanvas.height,o=t*ratio,i=t;croppedCanvas.width=o,croppedCanvas.height=i,ctxCropped.drawImage(sourceCanvas,(e-o)/2,(t-i)/2,o,i,0,0,croppedCanvas.width,croppedCanvas.height),document.querySelector("#clearButton").disabled=!1,document.querySelector("#uploadButton").disabled=!1}),document.getElementById("clearButton").addEventListener("click",()=>{ctxCropped.clearRect(0,0,croppedCanvas.width,croppedCanvas.height),document.querySelector("#clearButton").disabled=!0,document.querySelector("#uploadButton").disabled=!0}),document.getElementById("uploadButton").addEventListener("click",e=>{croppedCanvas.toBlob(e=>{let t=new FormData($("#form-foto-rofil")[0]);t.append("user_action","create"),t.append("file",e,"image.jpeg"),$("#progressContainer").show();let o=new XMLHttpRequest;o.upload.addEventListener("progress",e=>{if(e.lengthComputable){let t=e.loaded/e.total*100;$("#progressBar").val(t),$("#progressPercent").text(Math.round(t)+"%")}}),o.open("POST","foto-profil.php",!0),o.onload=()=>{200===o.status?window.location="foto-profil.php":alert("Failed to upload image.")},o.onerror=()=>{console.error("Error:",o.statusText),alert("Error uploading image.")},o.send(t)},"image/jpeg",.75)}),setupCamera()});